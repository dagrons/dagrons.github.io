<!DOCTYPE html>
<html><body>
<p>{ set_locale(lang) }}


</p>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="dagrons">
<title>br0没有ip地址解决方案 | NuLL</title>
<link href="../../assets/css/all.css" rel="stylesheet" type="text/css">
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<div id="wrp">
        <div id="cont">
            <div id="page">
                <header><h1>
                        <a href="https://dagrons.github.io/" title="NuLL" rel="home">NuLL</a>
                    </h1>
                </header><div id="body">
                    <nav><ul>
<li><a href="https://dagrons.github.io/" title="Home" rel="home"><i class="fa fa-fw fa-home"></i></a></li>
                            <li><a href="https://dagrons.github.io/categories/" title="Tags"><i class="fa fa-fw fa-tags"></i></a></li>
                            <li><a href="https://dagrons.github.io/rss.xml" title="RSS feed"><i class="fa fa-fw fa-rss"></i></a></li>                            
                            <li><a href="https://github.com/dagrons" title="My GitHub repo"><i class="fa fa-fw fa-github"></i></a></li>
                        </ul></nav><div id="content">
    <article class="post-text"><div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
        <h1 class="p-name" itemprop="headline name">br0没有ip地址解决方案</h1>

    <small>
        Posted: <time class="published dt-published" datetime="2021-09-09T14:14:32+08:00" itemprop="datePublished">2021-09-09 14:14</time></small>
    <div class="e-content" itemprop="articleBody text">
    <div>
<h2 id="_1">问题分析</h2>
<ol>
<li>br0没有ip，但enp0s31f6有ip</li>
<li>lxc list显示容器都没有ip, 推测br0没有正常工作</li>
<li>dhclient br0 无法成功</li>
<li>brctl show br0 在interfaces列没有enp0s31f6</li>
</ol>
<h2 id="_2">解决方案</h2>
<p>首先通过brctl show br0发现没有物理网卡绑定，因此通过</p>
<pre class="code literal-block">brctl addif br0 enp0s31f6
</pre>
<p>手动添加物理网卡, 添加后发现容器可以正常获取ip了</p>
<p>但host的br0仍然没有ip</p>
<p>然后重新修改/etc/netplan/01-netcfg.yaml</p>
<pre class="code literal-block"># <span class="k">For</span> <span class="nv">more</span> <span class="nv">information</span>, <span class="nv">see</span> <span class="nv">netplan</span><span class="ss">(</span><span class="mi">5</span><span class="ss">)</span>.
<span class="nv">network</span>:
  <span class="nv">version</span>: <span class="mi">2</span>
  <span class="nv">renderer</span>: <span class="nv">networkd</span>
  <span class="nv">ethernets</span>:
    <span class="nv">enp0s31f6</span>:
      <span class="nv">dhcp4</span>: <span class="nv">yes</span>
      <span class="nv">dhcp6</span>: <span class="nv">yes</span>
  <span class="nv">bridges</span>:
    <span class="nv">br0</span>:
      <span class="nv">dhcp4</span>: <span class="nv">yes</span>
      <span class="nv">dhcp6</span>: <span class="nv">yes</span>
      <span class="nv">interfaces</span>:
        <span class="o">-</span> <span class="nv">enp0s31f6</span>
</pre>
<p>重新载入配置</p>
<pre class="code literal-block">netplan --debug apply
</pre>
<p>发现br0成功得到ip</p>
<p>重启后依然生效</p>
</div>
    </div>
    </div>
            <ul class="pager">
<li class="previous">
                <a href="../goxue-xi-di-er-tian-zi-fu-chuan-xiang-guan/" rel="prev">← 上一篇文章</a>
            </li>
        </ul></article>
</div>
                </div>
                <div id="ftr">
                </div>
            </div>
        </div>
    </div>
	<footer><small>Contents © 2021         <a href="mailto:heyuehuii@126.com">dagrons</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </small>
	</footer>
</body></html>
