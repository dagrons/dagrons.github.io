<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="zh_cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Components, State machine, state, events, action | NuLL</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="zh_cn" href="../../rss.xml">
<link rel="canonical" href="https://dagrons.github.io/posts/components-state-machine-state-events-action/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="dagrons">
<link rel="prev" href="../yi-xie-jing-yan/" title="一些经验" type="text/html">
<link rel="next" href="../torch/" title="torch" type="text/html">
<meta property="og:site_name" content="NuLL">
<meta property="og:title" content="Components, State machine, state, events, action">
<meta property="og:url" content="https://dagrons.github.io/posts/components-state-machine-state-events-action/">
<meta property="og:description" content="Intro
The world is a state machine driven by events
events are what components listening on
components responds to different events with different actions
different components cares only about events ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-04-05T20:37:29+08:00">
<meta property="article:tag" content="js">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">跳到主内容</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">NuLL</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="index.md" id="sourcelink" class="nav-link">源文件</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">文章归档</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">标签</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS 源</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Components, State machine, state, events, action</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    dagrons
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-04-05T20:37:29+08:00" itemprop="datePublished" title="2021-04-05 20:37">2021-04-05 20:37</time></a>
            </p>
            
        <p class="sourceline"><a href="index.md" class="sourcelink">源文件</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<h2>Intro</h2>
<p>The world is a state machine driven by events</p>
<p>events are what components listening on</p>
<p>components responds to different events with different actions</p>
<p>different components cares only about events they listen on</p>
<p>state are what the actions condition on</p>
<p>Event handlers are actions registered on a event</p>
<p>some components share on some state while some do not</p>
<p>the actions of one components may affect the states of other components</p>
<p>the actions of one component can emit events to others.</p>
<p>It's always a bad practice for one component to emit events to itself.</p>
<p>in real world, all components runs on different thread, however it's not true in programming</p>
<h2>Event</h2>
<p>Understanding the capture phrase and bubble phrase of event passing, we can choose to register our event listener on the capture phrase or bubble phrase with the third optional parameter which is default to false(bubble)</p>
<p>We can use e.target to refer to the event target component and use e.srcElement to refer to the source component, however there may be no srcElement for some events such as ajax events.</p>
<p>event can be created with </p>
<pre class="code literal-block"><span class="nx">event</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">typeArg</span><span class="p">,</span> <span class="nx">eventInit</span><span class="p">);</span>
</pre>
<p>some important APIs for events are stopPropagation and preventDefault </p>
<h2>ICC (Inter Component Communication)</h2>
<p>Shared state: If A and B share some same state, it's ok to operate on the state directly</p>
<p>Function as args: A can pass a encapsulated function for B to call, executed immediately</p>
<p>Emit a event: A can emit a event to B to trigger B's event listener, not executed immediately</p>
<p>Children -&gt; parent: parent pass function to children as props/args, be careful to bind "this"!</p>
<p>Parent -&gt; children: props/args</p>
<p>Child &lt;-&gt; Child: shared context/state</p>
<p>The third approach is not recommended</p>
<h2>React</h2>
<blockquote>
<p>useState, useEffect, useReducer, when and why?</p>
</blockquote>
<p>in react, "state" are special state do something with ui behaviors, and can only be changed with setState, which will not be executed immediately, but will be changed in order they been pushed into the queue(which is synchronous opeation)
in other words, react "state" is what render action conditions on.</p>
<p>react "state" are not recommended when the next value depends on the previous value.</p>
<pre class="code literal-block"><span class="nv">suppose</span> <span class="nv">A</span> <span class="nv">component</span> <span class="nv">has</span> <span class="nv">a</span> <span class="nv">state</span> <span class="nv">binary</span> <span class="ss">(</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span><span class="ss">)</span>, <span class="k">if</span> <span class="nv">the</span> <span class="nv">only</span> <span class="nv">actions</span> <span class="nv">the</span> <span class="nv">component</span> <span class="k">do</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">state</span> <span class="nv">is</span> <span class="nv">to</span> <span class="nv">invert</span> <span class="nv">it</span>, 
<span class="nv">A</span> : 
<span class="nv">Invert</span> <span class="o">=&gt;</span> <span class="k">if</span> <span class="nv">binary</span> <span class="o">==</span> <span class="mi">1</span>: <span class="nv">setBinary</span> <span class="ss">(</span><span class="mi">0</span><span class="ss">)</span> <span class="k">else</span> <span class="nv">setBinary</span> <span class="ss">(</span><span class="mi">1</span><span class="ss">)</span>

<span class="nv">As</span> <span class="nv">we</span> <span class="nv">already</span> <span class="nv">know</span>, <span class="nv">setBinary</span> <span class="nv">are</span> <span class="nv">not</span> <span class="nv">executed</span> <span class="nv">immediately</span>, <span class="nv">instead</span>, <span class="nv">they</span> <span class="nv">are</span> <span class="nv">pushed</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">queue</span> <span class="nv">in</span> <span class="nv">order</span>
<span class="k">If</span> <span class="nv">A</span> <span class="nv">invert</span> <span class="nv">Binary</span> <span class="nv">twice</span> <span class="nv">when</span> <span class="nv">binary</span><span class="o">==</span><span class="mi">1</span>, <span class="nv">what</span> <span class="nv">we</span> <span class="nv">expected</span> <span class="nv">finally</span> <span class="nv">is</span> <span class="nv">bianry</span> <span class="o">==</span> <span class="mi">1</span>
<span class="nv">However</span>, <span class="k">if</span> <span class="nv">the</span> <span class="nv">second</span> <span class="nv">invert</span> <span class="nv">happens</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">setState</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">first</span> <span class="nv">invert</span> <span class="nv">been</span> <span class="nv">executed</span>. <span class="k">Then</span> <span class="nv">the</span> <span class="nv">binary</span> <span class="nv">would</span> <span class="nv">be</span> <span class="mi">0</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">end</span>, <span class="nv">not</span> <span class="nv">as</span> <span class="nv">we</span> <span class="nv">expected</span>.
</pre>
<p>To solve the above problem, we should useReducer.</p>
<pre class="code literal-block">const binary = {value: 0};

function reducer(state, action) {
  switch (action.type) {
    case 'invert':
      return {count: state.value^1};
    default:
      throw new Error();
  }
}

function Inverter() {
  const [state, dispatch] = useReducer(reducer, 1);
  return (
    <span class="err">&lt;</span>&gt;
      binary: {state.value}
      <span class="nt">&lt;button</span> <span class="na">onClick=</span><span class="s">{()</span> <span class="err">=</span><span class="nt">&gt;</span> dispatch({type: 'invert'})}&gt;invert<span class="nt">&lt;/button&gt;</span>
    <span class="err">&lt;</span>/&gt;
  );
}
</pre>
<p>the dispatched actions are pushed into the queue and ensured to  be executed in FIFO order.</p>
<p>Do not useReducer if useState works.</p>
<p>in react, useEffect defined what to execute after first render when or react "state" changes.</p>
<p>in react, components are organized in a tree structure, each components is a node on the tree.</p>
<p>in react, each components have at least one action called render, which listen on render events.</p>
<p><img alt="事件，状态，动作" src="../../images/QQ%E6%88%AA%E5%9B%BE20210405222133.png"><img alt="共享状态-组件通信" src="../../images/QQ%E6%88%AA%E5%9B%BE20210405213404.png"><img alt="React树形结构" src="../../images/QQ%E6%88%AA%E5%9B%BE20210405222359.png"></p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/js/" rel="tag">js</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../yi-xie-jing-yan/" rel="prev" title="一些经验">上一篇文章</a>
            </li>
            <li class="next">
                <a href="../torch/" rel="next" title="torch">下一篇文章</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:heyuehuii@126.com">dagrons</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
