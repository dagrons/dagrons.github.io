<!DOCTYPE html>
<html lang="zh_cn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>br0没有ip地址解决方案 | NuLL</title>
<style>
        @font-face {
            font-family: "libretto-icons";
            src:url(../../assets/fonts/libretto-icons.eot);
            src:url(../../assets/fonts/libretto-icons.eot#iefix) format("embedded-opentype"),
            url(../../assets/fonts/libretto-icons.woff) format("woff"),
            url(../../assets/fonts/libretto-icons.ttf) format("truetype"),
            url(../../assets/fonts/libretto-icons.svg#libretto-icons) format("svg");
            font-weight: normal;
            font-style: normal;
        }
    </style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Sans+Mono%7CLibre+Baskerville%7CMontserrat%7CPlayfair+Display">
<link rel="stylesheet" href="../../assets/css/libretto_styles.css">
</head>
<body>
    <!-- Navigation bar -->
    <header class="nav-bar"><div class="site-branding">
            <h1 class="site-title">
                <a href="https://dagrons.github.io/" title="NuLL" rel="home">NuLL</a>
            </h1>
        </div>
        <nav class="site-navigation" role="navigation"><div class="menu-toggle">
                <span class="mobile-site-title">NuLL</span>
            </div>
            <ul class="menu">
<li><a href="../../archive.html">文章归档</a></li>
                    <li><a href="../../categories/">标签</a></li>
                    <li><a href="../../rss.xml">RSS 源</a></li>
            </ul></nav></header><!-- Page Header --><div class="title-block post-format-icon-pin">
        <div class="entry-meta">
            <span class="posted-on">
                Posted on <a href="." rel="bookmark">%B %-9, %2021</a>
            </span>
        </div>
        <h1>br0没有ip地址解决方案</h1>
    </div>

        <!-- Page Content -->
    <div class="site-content" role="main">
        <article class="format-standard libretto-long-form"><div class="entry-content">
                <div>
<h2 id="_1">问题分析</h2>
<ol>
<li>br0没有ip，但enp0s31f6有ip</li>
<li>lxc list显示容器都没有ip, 推测br0没有正常工作</li>
<li>dhclient br0 无法成功</li>
<li>brctl show br0 在interfaces列没有enp0s31f6</li>
</ol>
<h2 id="_2">解决方案</h2>
<p>首先通过brctl show br0发现没有物理网卡绑定，因此通过</p>
<pre class="code literal-block">brctl addif br0 enp0s31f6
</pre>
<p>手动添加物理网卡, 添加后发现容器可以正常获取ip了</p>
<p>但host的br0仍然没有ip</p>
<p>然后重新修改/etc/netplan/01-netcfg.yaml</p>
<pre class="code literal-block"># <span class="k">For</span> <span class="nv">more</span> <span class="nv">information</span>, <span class="nv">see</span> <span class="nv">netplan</span><span class="ss">(</span><span class="mi">5</span><span class="ss">)</span>.
<span class="nv">network</span>:
  <span class="nv">version</span>: <span class="mi">2</span>
  <span class="nv">renderer</span>: <span class="nv">networkd</span>
  <span class="nv">ethernets</span>:
    <span class="nv">enp0s31f6</span>:
      <span class="nv">dhcp4</span>: <span class="nv">yes</span>
      <span class="nv">dhcp6</span>: <span class="nv">yes</span>
  <span class="nv">bridges</span>:
    <span class="nv">br0</span>:
      <span class="nv">dhcp4</span>: <span class="nv">yes</span>
      <span class="nv">dhcp6</span>: <span class="nv">yes</span>
      <span class="nv">interfaces</span>:
        <span class="o">-</span> <span class="nv">enp0s31f6</span>
</pre>
<p>重新载入配置</p>
<pre class="code literal-block">netplan --debug apply
</pre>
<p>发现br0成功得到ip</p>
<p>重启后依然生效</p>
</div>
            </div>
        </article>
</div>

        <!-- Tag Section -->

        <!-- Post Navigation links -->
<nav class="site-content navigation-post" role="navigation"><div class="previous">
            <a href="../goxue-xi-di-er-tian-zi-fu-chuan-xiang-guan/" rel="prev">
                <span class="meta-nav">Older Post</span>Go学习第二天-字符串相关
            </a>
        </div>
</nav><!-- Page Footer --><section class="footer-sidebar clear" role="complementary"><div class="widget-block">
            <aside class="widget"><h2 class="widget-title">NuLL</h2>
                <div class="widget-text">NuLL</div>
            </aside>
</div>
    </section><!-- Site Attributions --><footer class="site-footer" role="contentinfo"><div class="site-info">
            <p>Contents © 2021         <a href="mailto:heyuehuii@126.com">dagrons</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            <p>Powered by <a href="https://getnikola.com/">Nikola</a> using the <a href="https://note2self.abraham-v.com/libretto-theme-for-nikola/">Libretto theme</a>.</p>
        </div>
        <div class="social">
            <ul class="menu"></ul>
</div>
    </footer>
</body>
</html>
