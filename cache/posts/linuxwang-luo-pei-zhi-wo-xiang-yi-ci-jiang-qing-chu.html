<h2 id="_1">前言</h2>
<ul>
<li>linux网络配置复杂, 配置文件繁多, 因此经常产生困扰, 所以我想在这里一次性梳理好</li>
</ul>
<h2 id="_2">简介</h2>
<p>Linux的网络工具架构如下:</p>
<p><img alt="img" src="/images/networking.png">
<img src="/images/networking.png" style="width: 50%; height: 50%; text-align: center"></p>
<p>总的来说, 主要有两套backend, 一个是network-manager, 一个是system-networkd, </p>
<p><strong>network-manager vs system-networkd</strong>
network-manager主要用于GUI环境下的网络配置, system-networkd主要用于server环境下的网路配置, 但作用是一样的, 在netplan的术语中, 它们只是render, 即读取配置文件, 将需要配置的网络环境渲染出来</p>
<h2 id="_3">配置文件</h2>
<p><strong>传统配置文件</strong></p>
<p>/etc/network/interfaces是system-networkd的配置文件, 下面是一个典型的interfaces配置</p>
<pre class="code literal-block"># lab_host2:/etc/network/interfaces
auto lo
iface lo inet loopback

auto br0
iface br0 inet dhcp
    bridge-ports enp0s31f6    

iface enp0s31f6 inet manual
</pre>
<p>nmcli: 是network-manager的命令行配置工具</p>
<p><strong>netplan</strong></p>
<p>netplan的好处在于为system-networkd和network-manager提供了一致的配置文件, 从而避免两个render间的冲突, 在netplan中, 我们可以通过renderer关键词指定renderer, 除此之外的语法都是一致的</p>
<p>如下, 是一个典型的netplan配置文件, 指定renderer为networkd</p>
<pre class="code literal-block"><span class="c1"># lab_host3:/etc/netplan/01-netcfg.yaml</span>
<span class="nt">network</span><span class="p">:</span>
  <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="nt">renderer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networkd</span>
  <span class="nt">ethernets</span><span class="p">:</span>
    <span class="nt">enp0s31f6</span><span class="p">:</span>
      <span class="nt">dhcp4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
      <span class="nt">dhcp6</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class="nt">bridges</span><span class="p">:</span>
    <span class="nt">br0</span><span class="p">:</span>
      <span class="nt">dhcp4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
      <span class="nt">dhcp6</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
      <span class="nt">interfaces</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">enp0s31f6</span>
</pre>